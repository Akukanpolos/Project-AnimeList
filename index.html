<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Anime List</title>
  <style>
    body {
      font-family: sans-serif;
      background: #121212;
      color: #fff;
      margin: 0;
      padding: 10px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .profile {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .profile img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }
    .profile-info {
      display: flex;
      flex-direction: column;
    }
    .controls {
      display: flex;
      gap: 10px;
    }
    .controls button {
      background: #333;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    .form-container {
      margin-top: 10px;
      display: none;
      flex-direction: column;
      gap: 5px;
      background: #1e1e1e;
      padding: 10px;
      border-radius: 10px;
    }
    .form-container input {
      padding: 6px;
      border: none;
      border-radius: 6px;
    }
    .status-buttons {
      display: flex;
      gap: 5px;
    }
    .status-btn {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
    }
    .red { background: red; }
    .yellow { background: yellow; }
    .green { background: limegreen; }
    .anime-list {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .anime-card {
      display: flex;
      background: #1e1e1e;
      border-radius: 10px;
      padding: 10px;
      gap: 10px;
      align-items: center;
    }
    .anime-card img {
      width: 70px;
      height: 100px;
      object-fit: cover;
      border-radius: 6px;
    }
    .anime-info {
      flex: 1;
    }
    .anime-info strong {
      font-size: 16px;
    }
    .anime-actions button {
      margin-left: 5px;
      background: #444;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="profile">
      <img src="https://deposit.pictures/media/images/58/e1/cb/58e1cb6be7e44a209a1b10caba2a37c3.jpg" alt="profile">
      <div class="profile-info">
        <div><strong>F_Dragon</strong></div>
        <div>Level: <span id="level">1</span> | Rank: Premium</div>
      </div>
    </div>
    <div class="controls">
      <button onclick="toggleForm('search')">Search</button>
      <button onclick="toggleForm('add')">+</button>
    </div>
  </div>

  <div id="searchForm" class="form-container">
    <input type="text" id="searchInput" placeholder="Cari judul..." oninput="handleSearch()">
  </div>

  <div id="addForm" class="form-container">
    <input type="text" id="judul" placeholder="Judul Anime">
    <input type="number" id="episode" placeholder="Episode Terakhir">
    <input type="text" id="gambar" placeholder="Link Gambar">
    <div class="status-buttons">
      <button class="status-btn green" onclick="setStatus('On Going')"></button>
      <button class="status-btn red" onclick="setStatus('Stop')"></button>
      <button class="status-btn yellow" onclick="setStatus('Selesai')"></button>
    </div>
    <button onclick="submitAnime()">Simpan</button>
  </div>

  <div class="anime-list" id="animeList"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // Firebase config dari project kamu
    const firebaseConfig = {
      apiKey: "AIzaSyALaTxq2sfXDB8AkgNF4BylmC5nE3nvLT0",
      authDomain: "anime-list.firebaseapp.com",
      databaseURL: "https://anime-list-default-rtdb.firebaseio.com",
      projectId: "anime-list",
      storageBucket: "anime-list.appspot.com",
      messagingSenderId: "44646224970",
      appId: "1:44646224970:web:9f303dfcbdd39c174e76e1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let editKey = null;
    let selectedStatus = "";

    function toggleForm(type) {
      document.getElementById("searchForm").style.display = type === 'search' ? 'flex' : 'none';
      document.getElementById("addForm").style.display = type === 'add' ? 'flex' : 'none';
    }

    function setStatus(status) {
      selectedStatus = status;
    }

    function submitAnime() {
      const judul = document.getElementById("judul").value;
      const episode = document.getElementById("episode").value;
      const gambar = document.getElementById("gambar").value;

      if (!judul || !episode || !gambar || !selectedStatus) {
        alert("Lengkapi semua field!");
        return;
      }

      const data = { judul, episode, gambar, status: selectedStatus };

      if (editKey) {
        db.ref("anime/" + editKey).set(data);
        editKey = null;
      } else {
        db.ref("anime").push(data);
      }

      // Reset form & tutup menu
      document.getElementById("judul").value = "";
      document.getElementById("episode").value = "";
      document.getElementById("gambar").value = "";
      selectedStatus = "";
      document.getElementById("addForm").style.display = "none";
    }

    function handleSearch() {
      renderAnime();
      const searchVal = document.getElementById("searchInput").value;
      if (searchVal === "") {
        document.getElementById("searchForm").style.display = "none";
      }
    }

    function renderAnime() {
      const container = document.getElementById("animeList");
      const searchKeyword = (document.getElementById("searchInput")?.value || "").toLowerCase();
      db.ref("anime").once("value", (snapshot) => {
        const data = snapshot.val();
        container.innerHTML = "";
        let count = 0;

        for (const key in data) {
          const anime = data[key];
          if (!anime.judul.toLowerCase().includes(searchKeyword)) continue;
          count++;

          const card = document.createElement("div");
          card.className = "anime-card";

          const img = document.createElement("img");
          img.src = anime.gambar;

          const info = document.createElement("div");
          info.className = "anime-info";
          info.innerHTML = `<strong>${anime.judul}</strong><br>Episode: ${anime.episode}`;

          const statusColor = anime.status === "Selesai" ? "yellow" : anime.status === "On Going" ? "green" : "red";
          const statusDot = document.createElement("div");
          statusDot.className = `status-btn ${statusColor}`;
          statusDot.style.marginTop = "5px";

          const actions = document.createElement("div");
          actions.className = "anime-actions";
          const editBtn = document.createElement("button");
          editBtn.textContent = "Edit";
          editBtn.onclick = () => {
            document.getElementById("judul").value = anime.judul;
            document.getElementById("episode").value = anime.episode;
            document.getElementById("gambar").value = anime.gambar;
            selectedStatus = anime.status;
            toggleForm("add");
            editKey = key;
          };

          const delBtn = document.createElement("button");
          delBtn.textContent = "Hapus";
          delBtn.onclick = () => db.ref("anime/" + key).remove();

          actions.appendChild(editBtn);
          actions.appendChild(delBtn);

          card.appendChild(img);
          card.appendChild(info);
          card.appendChild(statusDot);
          card.appendChild(actions);

          container.appendChild(card);
        }

        const level = Math.floor(count / 50) + 1;
        document.getElementById("level").textContent = level;
      });
    }

    db.ref("anime").on("value", renderAnime);
  </script>
</body>
      </html>
